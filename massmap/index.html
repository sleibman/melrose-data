---
layout: default
title: Per-pupil expenditures in Massachusetts school districts
---

  <style>
    .land {
      fill: #a1a1a1;
      stroke: #000;
      stroke-width: .1px;
    }
    .hidden {
      display: none;
    }
    div.tooltip {
      color: #222;
      background: #fff;
      padding: .5em;
      text-shadow: #f5f5f5 0 1px 0;
      border-radius: 2px;
      box-shadow: 0px 0px 2px 0px #a6a6a6;
      opacity: 0.9;
      position: absolute;
    }
  </style>
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-941940-28']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

<body>

<div id="top">
  <p><img src="legend.png"></p>
  <div id="mapspot"></div>

  <p>Source: <a href="http://profiles.doe.mass.edu/statereport/ppx.aspx">http://profiles.doe.mass.edu/statereport/ppx.aspx</a></p>
</div>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>
  var width = 960,
    height = 500;

  var tooltip = d3.select("div#mapspot").append("div").attr("class", "tooltip hidden");

  function redraw() {
    var s = d3.event.scale;
    var t = d3.event.translate;
    svg.style("stroke-width", 1 / s).attr("transform", "translate(" + t + ")scale(" + s + ")");
  }

  var projection = d3.geo.albersUsa()
    .scale(10000)
    .translate([-2800, 1200]);

  var path = d3.geo.path().projection(projection);

  var svg = d3.select("div#mapspot").append("svg")
    .attr("width", width)
    .attr("height", height)
    .call(d3.behavior.zoom()
      .on("zoom", redraw))
    .append("g")

//  var color = d3.scale.category20c();
  var color = function (id) {
    console.log(id);
    if (id === "BROOKFIELD" ||
    id === "BERKLEY" ||
      id === "EAST BRIDGEWATER" ||
      id === "CHARLTON" ||
      id === "DUDLEY" ||
      id === "SOUTHAMPTON" ||
      id === "NORTH ATTLEBOROUGH" ||
      id === "QUABOAG") {
      return "yellow";
    }
    if (id === "MELROSE") {
      return "red";
    } else {
      return "blue";
    }
  };

  d3.json("ma.topo.json", function(error, ma) {

    var topo = topojson.feature(ma, ma.objects.ma).features;

    var town = svg.selectAll(".land").data(topo);

    town.enter().insert("path")
      .attr("class", "land")
      .attr("d", path)
      .attr("id", function(d,i) { return d.id; })
      .style("fill", function(d,i) { return color(d.id) });

    //tooltips
    town
      .on("mousemove", function(d,i) {
        var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
        tooltip
          .classed("hidden", false)
          .attr("style", "left:"+(mouse[0])+"px;top:"+(mouse[1])+"px")
          .html(d.id)
      })
      .on("mouseout",  function(d,i) {
        tooltip.classed("hidden", true)
      });

  });

  d3.select(self.frameElement).style("height", height + "px");
</script>
</body>
</html>
